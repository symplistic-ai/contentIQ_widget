!function(){const e=document.currentScript;if(!e)return void console.error("[contentIQ widget] Script tag not found");const n=e.dataset.token,t=document.querySelector(".contentiq_symplisticai_chat");if(!t)return void console.error("[contentIQ widget] Root DIV not found");const o=t.dataset.agent,r=e.dataset.backend||"http://localhost:1234";let i=null;const s=window.contentIQConfig?.threadTimeoutMinutes||5,a=60*s*1e3;console.log(`[contentIQ widget] Thread timeout set to ${s} minutes`);const l=`contentiq_session_${o}`,c=localStorage.getItem(l);if(c)try{const e=JSON.parse(c);i=e.sessionId,console.log("[contentIQ widget] Using existing session"),e.lastActivity=Date.now(),localStorage.setItem(l,JSON.stringify(e))}catch(e){console.log("[contentIQ widget] Invalid session data, creating new one"),localStorage.removeItem(l)}if(!i){const e=Date.now(),n=Math.random().toString(36).substring(2,15);i=`session_${`${e}_${n}`}`;const t={sessionId:i,lastActivity:Date.now(),created:Date.now()};localStorage.setItem(l,JSON.stringify(t)),console.log("[contentIQ widget] Created new session")}function d(){const e=localStorage.getItem(l);if(e)try{const n=JSON.parse(e);n.lastActivity=Date.now(),localStorage.setItem(l,JSON.stringify(n))}catch(e){console.warn("[contentIQ widget] Failed to update session activity")}}function p(){const e=localStorage.getItem(l);if(e)try{const n=JSON.parse(e).lastActivity||0;if(Date.now()-n>=a)return console.log("[contentIQ widget] Thread timed out, will create new session"),!0}catch(e){console.warn("[contentIQ widget] Error checking thread timeout:",e)}return!1}window.contentIQExpireSession=function(){localStorage.removeItem(l),console.log("[contentIQ widget] Session manually expired"),location.reload()},window.contentIQCheckThreadTimeout=p,i&&function(e){return e&&e.includes("Mozilla")||e.includes("Chrome")||e.includes("Safari")}(i)&&(console.log("[contentIQ widget] Detected old session format, cleaning up"),localStorage.removeItem(l),i=null);const g=new TextEncoder;async function h(e,n){const t=Uint8Array.from(e.match(/.{1,2}/g).map(e=>parseInt(e,16))),o=await crypto.subtle.importKey("raw",t,{name:"HMAC",hash:"SHA-256"},!1,["sign"]),r=await crypto.subtle.sign("HMAC",o,g.encode(n));return i=new Uint8Array(r),Array.from(i).map(e=>e.toString(16).padStart(2,"0")).join("");var i}async function u(){const e=Math.floor(Date.now()/1e3).toString(),t=await h(n,`${e}|${o}`);return{agent_id:o,token:n,ts:e,sig:t}}(async()=>{try{const{ts:e,sig:t}=await u(),i=new URL(r+"/api/deploy/validateToken");i.searchParams.set("agent_id",o),i.searchParams.set("token",n),i.searchParams.set("ts",e),i.searchParams.set("sig",t);await fetch(i).then(e=>e.ok)||console.warn("[contentIQ widget] Token validation failed")}catch(e){console.warn("[contentIQ widget] Validation error",e)}})();const x={brandName:"symplistic.contentIQ",defaultMessage:"Welcome to symplistic.ai! Ask me anything!",backgroundColor:"linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #000000 100%)",accentColor:"#246BFD",accentColorDark:"#0F56E0",textColor:"#111827",mutedColor:"#8E8E93",borderColor:"#E5E8F0",agentName:"ContentIQ",headerColor:"#ffffff",agentBubbleColor:"#1a1a1a",agentTextColor:"#ffffff",userBubbleColor:"#246BFD",userCircleColor:"#246BFD",userTextColor:"#ffffff",inputBackgroundColor:"linear-gradient(180deg, #1a1a1a 0%, #0f0f0f 100%)",inputTextColor:"#ffffff",rootBorder:"#ECEEF5",rootBoxShadow:"0 22px 48px rgba(17,24,39,0.18), 0 2px 8px rgba(17,24,39,0.06)",fontFamily:"-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial"};let f={...x};function m(){t.style.setProperty("--ciq-blue",f.accentColor),t.style.setProperty("--ciq-blue-dark",f.accentColorDark||f.accentColor),t.style.setProperty("--ink",f.textColor),t.style.setProperty("--muted",f.mutedColor),t.style.setProperty("--border",f.borderColor)}(async function(){try{console.log("[contentIQ widget] Fetching custom styling with GET method...");const{ts:e,sig:t}=await u(),i=new URL(r+"/api/deploy/getEmbedStyling");i.searchParams.set("agent_id",o),i.searchParams.set("token",n),i.searchParams.set("ts",e),i.searchParams.set("sig",t);const s=await fetch(i);if(s.ok){const e=await s.json();if(console.log("[contentIQ widget] Fetched custom styling response:",e),e.success&&e.styling){const n=e.styling;return console.log("[contentIQ widget] Using custom styling:",n),{...x,...n}}return console.log("[contentIQ widget] Invalid response structure, using defaults"),x}return console.log("[contentIQ widget] No custom styling found, using defaults"),x}catch(e){return console.warn("[contentIQ widget] Error fetching custom styling:",e),x}})().then(e=>{f=e,m()}).catch(e=>{console.warn("[contentIQ widget] Using default styling due to fetch error:",e)}),m(),t.style.cssText="\n  --ciq-blue:#246BFD; --ciq-blue-dark:#0F56E0;\n  --ink:#111827; --muted:#8E8E93; --border:#E5E8F0;\n\n  position: fixed; bottom: 60px; right: 24px;\n  width: 64px; height: 64px;             /* Start as small icon */\n  display:flex; align-items:center; justify-content:center; z-index:9999;\n  border-radius: 50%;\n  border: 1px solid #ECEEF5;\n  background: var(--ciq-blue);\n  box-shadow: 0 22px 48px rgba(17,24,39,0.18), 0 2px 8px rgba(17,24,39,0.06);\n  font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial;\n  color: var(--ink);\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n";const b=document.createElement("div");b.style.cssText="\nbackground: transparent;\npadding: 18px 22px 0;                    /* tighter top bar */\ndisplay:flex; align-items:center; gap:12px;\njustify-content:center;                  /* ← centered like screenshot */\ntext-align:center;                       /* ensure text centers with logo */\nposition: relative;\n";const y=document.createElement("button");y.style.cssText="\nposition: absolute;\ntop: 18px;\nright: 22px;\nwidth: 24px;\nheight: 24px;\nborder: none;\nbackground: transparent;\ncursor: pointer;\ndisplay: flex;\nalign-items: center;\njustify-content: center;\ncolor: #ffffff;\nfont-size: 18px;\nfont-weight: bold;\nborder-radius: 50%;\ntransition: background-color 0.2s ease;\n",y.innerHTML="×",y.onmouseover=()=>{y.style.backgroundColor="rgba(0,0,0,0.1)"},y.onmouseout=()=>{y.style.backgroundColor="transparent"},y.onclick=e=>{e.stopPropagation(),U()};const w=document.createElement("button");w.style.cssText="\nposition: absolute;\ntop: 18px;\nright: 50px;\nwidth: 24px;\nheight: 24px;\nborder: none;\nbackground: transparent;\ncursor: pointer;\ndisplay: flex;\nalign-items: center;\njustify-content: center;\ncolor: #ffffff;\nfont-size: 16px;\nfont-weight: bold;\nborder-radius: 50%;\ntransition: background-color 0.2s ease;\n",w.innerHTML=O("expand"),w.title="Make larger",w.onmouseover=()=>{w.style.backgroundColor="rgba(0,0,0,0.1)"},w.onmouseout=()=>{w.style.backgroundColor="transparent"},w.onclick=e=>{e.stopPropagation(),function(){V=!V,V?(t.style.width="600px",t.style.height="800px",j.style.width="600px",j.style.height="800px",w.innerHTML=O("shrink"),w.title="Make smaller"):(t.style.width="420px",t.style.height="650px",j.style.width="420px",j.style.height="650px",w.innerHTML=O("expand"),w.title="Make larger");document.querySelectorAll(".source-cards-container").forEach(e=>{const n=e.querySelector(".cards-container"),t=e.querySelector(".scrollable-area"),o=e.querySelectorAll(".source-card");if(n&&t&&o.length>0){const e=V?"500px":"300px";n.style.width=e,n.style.maxWidth=e,t.style.width=e,t.style.maxWidth=e,o.forEach(n=>{n.style.width=e,n.style.minWidth=e,n.style.maxWidth=e})}})}()};const v=document.createElement("div"),k=document.createElement("div");k.innerHTML=`<span style="color:${f.headerColor};">${f.brandName}</span>`,k.style.cssText="\nfont-weight: 800; font-size: 18px; letter-spacing:.2px; margin-top: 10px;\nmargin-left: -18px;\n";const C=document.createElement("div");C.style.cssText="display:none;",C.textContent=(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),b.append(v,k,C,w,y);const T=document.createElement("div");T.style.cssText="\nflex:1; overflow-y:auto;\npadding: 60px 22px 10px 22px;            /* ↑ adds space under header */\nbackground: transparent;\n";const _=document.createElement("div");_.style.cssText="\ndisplay:flex; align-items:flex-start; gap:12px;\nmargin: 0 0 16px;                        /* increased spacing between messages */\n";const E=document.createElement("div");E.style.cssText="\nwidth: 40px; height: 40px; border-radius: 50%; flex-shrink:0;\nbackground: var(--ciq-blue); color:#fff; font-weight:700; font-size:15px;\ndisplay:flex; align-items:center; justify-content:center;\nbox-shadow: 0 10px 22px rgba(36,107,253,.35);\n",E.textContent=f.agentName.charAt(0).toUpperCase();const I=document.createElement("div");I.style.cssText="flex:1;";const q=document.createElement("div");q.style.cssText="\nfont-weight:700; font-size:15px; color:#ffffff; margin: 4px 0 8px; display:flex; align-items:center; gap:12px;\n",q.textContent=f.agentName;const $=document.createElement("div");$.style.cssText=`\nbackground: ${f.agentBubbleColor};\nborder: 1px solid #333333;\ncolor: ${f.agentTextColor};\npadding: 14px 16px;\nborder-radius: 20px;\nfont-size: 15px; line-height: 1.45;\nwidth: 96%;\nmax-width: 100%;\nword-wrap: break-word;\noverflow-wrap: break-word;\nword-break: normal;\nhyphens: none;\noverflow: hidden;\nbox-shadow: 0 8px 22px rgba(0,0,0,.3);\nmargin-bottom: 16px;\n`,$.textContent=f.defaultMessage;const z=document.createElement("div");z.style.cssText="display:flex; gap:12px; align-items:center; margin-left:2px;",["copy","thumbs-up","thumbs-down"].forEach(e=>{const n=document.createElement("div");n.style.cssText="\n  width:28px; height:28px;\n  display:flex; align-items:center; justify-content:center;\n  border-radius:10px; background:#1a1a1a; border:1px solid #333333;\n  cursor:pointer; transition: background .15s ease, border-color .15s ease, transform .1s ease;\n  box-shadow: 0 3px 8px rgba(0,0,0,.2);\n  color: #ffffff;\n",n.innerHTML=O(e),n.onmouseover=()=>{n.style.background="#333333",n.style.borderColor="var(--ciq-blue)",n.style.transform="translateY(-1px)"},n.onmouseout=()=>{n.style.background="#1a1a1a",n.style.borderColor="#333333",n.style.transform="none"},z.appendChild(n)}),I.append(q,$,z),_.append(E,I);const S=document.createElement("div");S.style.cssText="display:none;",T.append(_,S);const M=document.createElement("div");M.style.cssText="\nposition: relative;\nbackground: transparent;\npadding: 12px 22px 22px 22px;\nborder-top: 0;\ndisplay: flex; flex-direction: column; gap: 8px;\n";const B=document.createElement("input");B.type="text",B.placeholder="Ask me anything...",B.style.cssText=`\nwidth: 100%;\nheight: 56px;\nbackground: ${f.inputBackgroundColor};\nborder: 1px solid #333333;\nborder-radius: 22px;\npadding: 0 76px 0 50px;            /* room for mic + right breathing */\nfont-size: 16px; color: ${f.inputTextColor}; outline: none;\nbox-shadow:\n  inset 0 1px 0 rgba(255,255,255,.1),\n  0 12px 28px rgba(0,0,0,.3);\n`;const Q=document.createElement("button");Q.style.cssText="\n position: absolute;\n left: 18px;\n top: 52%; transform: translateY(-50%);\n width: 22px; height: 22px;\n border: 0; background: transparent; padding: 0; margin: 0;\n display: flex; align-items: center; justify-content: center;\n color: #6B7280; opacity: .95; cursor: pointer;\n",Q.innerHTML=O("mic"),Q.style.zIndex="2",Q.onmouseover=()=>Q.style.opacity="1",Q.onmouseout=()=>Q.style.opacity=".9";const L=document.createElement("button");L.classList.add("ciq-fab"),L.style.cssText="\n position: absolute;\n right: -2px; top: 50%; transform: translateY(-50%);\n width: 64px; height: 64px;\n border: none; border-radius: 50%;\n background: #246BFD;\n display: flex; align-items: center; justify-content: center; cursor: pointer;\n z-index: 1;                                         /* only above input, not disclaimer */\n filter: drop-shadow(0 6px 16px rgba(36,107,253,.35));\n transition: background .12s ease;\n",L.innerHTML=O("send"),L.style.zIndex="3",L.onmouseover=()=>{L.style.background="#0F56E0"},L.onmouseout=()=>{L.style.background="#246BFD"};const H=document.createElement("style");H.textContent+="\n.contentiq_symplisticai_chat input::placeholder { color:#666666; opacity:1; }\n\n/* Markdown styling */\n.contentiq_symplisticai_chat strong { font-weight: 700; }\n.contentiq_symplisticai_chat em { font-style: italic; }\n.contentiq_symplisticai_chat code { \n  background: rgba(0,0,0,0.1); \n  padding: 2px 4px; \n  border-radius: 4px; \n  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;\n  font-size: 0.9em;\n}\n.contentiq_symplisticai_chat ul { \n  margin: 8px 0; \n  padding-left: 20px; \n}\n.contentiq_symplisticai_chat li { \n  margin: 4px 0; \n  line-height: 1.4; \n}\n.contentiq_symplisticai_chat pre {\n  background: rgba(0,0,0,0.1);\n  border: 1px solid rgba(0,0,0,0.2);\n  border-radius: 6px;\n  padding: 12px;\n  margin: 8px 0;\n  overflow-x: auto;\n  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;\n  font-size: 13px;\n  line-height: 1.4;\n}\n.contentiq_symplisticai_chat pre code {\n  background: none;\n  padding: 0;\n}\n.contentiq_symplisticai_chat .list-item {\n  margin: 8px 0;\n  line-height: 1.4;\n  padding-left: 0;\n}\n.contentiq_symplisticai_chat .list-item strong {\n  color: #ffffff;\n  font-weight: 600;\n}\n.contentiq_symplisticai_chat blockquote {\n  border-left: 4px solid var(--ciq-blue);\n  margin: 8px 0;\n  padding: 8px 12px;\n  background: rgba(36,107,253,0.1);\n  border-radius: 0 6px 6px 0;\n}\n.contentiq_symplisticai_chat h1, .contentiq_symplisticai_chat h2, .contentiq_symplisticai_chat h3,\n.contentiq_symplisticai_chat h4, .contentiq_symplisticai_chat h5, .contentiq_symplisticai_chat h6 {\n  margin: 12px 0 6px 0;\n  font-weight: 600;\n  line-height: 1.3;\n  color: #ffffff;\n}\n.contentiq_symplisticai_chat h1 { font-size: 20px; }\n.contentiq_symplisticai_chat h2 { font-size: 18px; }\n.contentiq_symplisticai_chat h3 { font-size: 16px; }\n.contentiq_symplisticai_chat h4 { font-size: 15px; }\n.contentiq_symplisticai_chat h5 { font-size: 14px; }\n.contentiq_symplisticai_chat h6 { font-size: 13px; }\n.contentiq_symplisticai_chat hr {\n  border: none;\n  border-top: 2px solid rgba(255,255,255,0.2);\n  margin: 12px 0;\n}\n.contentiq_symplisticai_chat .table-wrapper {\n  overflow-x: auto;\n  margin: 8px 0;\n  border-radius: 6px;\n  box-shadow: 0 2px 8px rgba(0,0,0,0.2);\n  width: 100%;\n  max-width: 100%;\n  box-sizing: border-box;\n}\n.contentiq_symplisticai_chat table {\n  border-collapse: collapse;\n  width: 250%;\n  max-width: 250%;\n  font-size: 13px;\n  background: rgba(0,0,0,0.1);\n  border-radius: 6px;\n  overflow: hidden;\n  table-layout: fixed;\n}\n.contentiq_symplisticai_chat th, .contentiq_symplisticai_chat td {\n  border: 1px solid rgba(255,255,255,0.2);\n  padding: 8px 10px;\n  text-align: left;\n  word-wrap: break-word;\n  overflow-wrap: break-word;\n  hyphens: auto;\n  vertical-align: top;\n  white-space: normal;\n  min-width: fit-content;\n}\n.contentiq_symplisticai_chat th {\n  background: rgba(36,107,253,0.2);\n  font-weight: 600;\n  color: #ffffff;\n}\n.contentiq_symplisticai_chat tr:nth-child(even) {\n  background: rgba(255,255,255,0.05);\n}\n.contentiq_symplisticai_chat tr:hover {\n  background: rgba(36,107,253,0.1);\n}\n.contentiq_symplisticai_chat a { \n  color: var(--ciq-blue); \n  text-decoration: underline; \n}\n.contentiq_symplisticai_chat a:hover { \n  color: #0F56E0; \n}\n\n/* Feedback button styling */\n.contentiq_symplisticai_chat [data-feedback-button].selected-feedback {\n  box-shadow: 0 4px 12px rgba(0,0,0,0.1);\n}\n.contentiq_symplisticai_chat [data-feedback-button=\"thumbs-up\"].selected-feedback {\n  animation: pulse-green 2s infinite;\n}\n.contentiq_symplisticai_chat [data-feedback-button=\"thumbs-down\"].selected-feedback {\n  animation: pulse-red 2s infinite;\n}\n@keyframes pulse-green {\n  0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }\n  70% { box-shadow: 0 0 0 6px rgba(16, 185, 129, 0); }\n  100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }\n}\n@keyframes pulse-red {\n  0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }\n  70% { box-shadow: 0 0 0 6px rgba(239, 68, 68, 0); }\n  100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }\n}\n\n/* double halo around the blue FAB */\n.contentiq_symplisticai_chat .ciq-fab::before,\n.contentiq_symplisticai_chat .ciq-fab::after{\n  content:\"\"; position:absolute; left:50%; top:50%;\n  border-radius:50%; pointer-events:none; transform:translate(-50%,-50%);\n}\n/* outer soft ring */\n.contentiq_symplisticai_chat .ciq-fab::before{\n  width:112px; height:112px;\n  background: radial-gradient(circle,\n    rgba(36,107,253,.16) 0%, rgba(36,107,253,.10) 55%, rgba(36,107,253,0) 70%);\n  filter: blur(2px);\n}\n/* inner tighter ring */\n.contentiq_symplisticai_chat .ciq-fab::after{\n  width:88px; height:88px;\n  background: radial-gradient(circle,\n    rgba(36,107,253,.22) 0%, rgba(36,107,253,.14) 55%, rgba(36,107,253,0) 72%);\n}\n\n/* Typing indicator animation */\n@keyframes typing-dot {\n  0%, 60%, 100% {\n    transform: translateY(0);\n    opacity: 0.4;\n  }\n  30% {\n    transform: translateY(-10px);\n    opacity: 1;\n  }\n}\n",document.head.appendChild(H);const D="\n  color: #246BFD;\n  text-decoration: none;\n  font-weight: 500;\n  border-bottom: 1px solid transparent;\n  transition: border-color 0.2s ease;\n",F=document.createElement("div");F.style.cssText="\nfont-size: 11px;\ncolor: #999999;\ntext-align: center;\nmargin-top: 8px;\nline-height: 1.3;\nopacity: 0.8;\nwidth: 100%;\nposition: relative;\nz-index: 2;\n",F.textContent="contentIQ can make mistakes. Check important info here.";const N=document.createElement("div");N.style.cssText="\nposition: relative;\nwidth: 100%;\ndisplay: flex;\nalign-items: center;\ngap: 8px;\n",N.append(B,Q,L),M.append(N,F);const A=document.createElement("div");A.style.cssText="\nwidth: 40px; height: 40px; border-radius: 50%;\nbackground: var(--ciq-blue); color:#fff; font-weight:700; font-size:18px;\ndisplay:flex; align-items:center; justify-content:center;\nbox-shadow: 0 10px 22px rgba(36,107,253,.35);\ncursor: grab;\n",A.innerHTML=O("chat");const j=document.createElement("div");j.style.cssText=`\nwidth: 420px; height: 650px;\ndisplay: none; flex-direction: column; overflow: hidden;\nborder-radius: 22px;\nborder: 1px solid #333333;\nbackground: ${f.backgroundColor};\nbox-shadow: 0 22px 48px rgba(0,0,0,0.4), 0 2px 8px rgba(0,0,0,0.2);\nposition: relative;\ntransition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n`;let V=!1;let P=!1;function U(){P=!P,P?(t.style.width=V?"600px":"420px",t.style.height=V?"800px":"650px",t.style.borderRadius="22px",t.style.flexDirection="column",t.style.overflow="hidden",A.style.display="none",j.style.display="flex",d()):(t.style.width="64px",t.style.height="64px",t.style.borderRadius="50%",t.style.flexDirection="row",t.style.overflow="visible",A.style.display="flex",j.style.display="none")}function O(e){return{copy:'<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>',"thumbs-up":'<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2z"/></svg>',"thumbs-down":'<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.59-6.59c.36-.36.58-.86.58-1.41V5c0-1.1-.9-2-2-2zm4 0v12h4V3h-4z"/></svg>',mic:'<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 3 2.89 5.35 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.43 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14z"/></svg>',send:'<svg width="22" height="22" viewBox="0 0 24 24" fill="white" style="transform: translateX(1px);"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>',expand:'<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>',shrink:'<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/></svg>',chat:'<svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>'}[e]||""}function R(e,n=!1,o=null){const r=document.createElement("div");r.style.cssText=`\n  display:flex; align-items:flex-start; gap:12px; margin: 0 0 20px;\n  ${n?"flex-direction: row-reverse;":""}\n`;const i=document.createElement("div"),s=n?f.userCircleColor||"var(--ciq-blue)":f.accentColor||"var(--ciq-blue)";if(i.style.cssText=`\n  width:40px; height:40px; border-radius:50%; flex-shrink:0;\n  background: ${s}; color:#fff; font-weight:700; font-size:15px;\n  display:flex; align-items:center; justify-content:center;\n  box-shadow: 0 10px 22px rgba(36,107,253,.35);\n`,n)i.textContent="U";else{const e=(f.agentName||"ContentIQ").charAt(0).toUpperCase();i.textContent=e}const a=document.createElement("div");a.style.cssText=`flex:1; display:flex; flex-direction:column; align-items:${n?"flex-end":"flex-start"};`;const l=n?[]:function(e){const n=[],t=/【(\d+)】\s*([^【]+?)(?=【\d+】|$)/g;let o;for(;null!==(o=t.exec(e));){const e=o[1],t=o[2].trim(),r=t.match(/(https?:\/\/[^\s]+)/),i=r?r[1]:"",s=t.replace(i,"").replace(/^[–—]\s*/,"").trim();i&&s&&n.push({number:e,url:i,description:s})}return n}(e),c=n?e:e.replace(/Sources[\s\S]*$/,"").trim(),d=document.createElement("div");if(d.style.cssText=`\n  background:${n?f.userBubbleColor||"var(--ciq-blue)":f.agentBubbleColor||"#1a1a1a"};\n  color:${n?f.userTextColor||"#fff":f.agentTextColor||"#ffffff"};\n  padding: 12px 16px;\n  border-radius: 20px;\n  border: 1px solid ${n?f.userBubbleColor||"var(--ciq-blue)":"#333333"};\n  font-size:15px; line-height:1.45; \n  width:${n?"auto":"96%"}; \n  max-width:${n?"none":"100%"};\n  overflow: hidden;\n  word-wrap:break-word; \n  overflow-wrap:break-word;\n  word-break: break-word;\n  hyphens: auto;\n  box-sizing: border-box;\n  box-shadow:${n?"0 12px 28px rgba(36,107,253,.30)":"0 8px 22px rgba(0,0,0,.3)"};\n`,d.innerHTML=function(e){if(!e)return"";let n=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return n=n.replace(/【(\d+)】/g,'<sup style="color: #6b7280; font-size: 0.8em; font-weight: 500;">[$1]</sup>'),n=n.replace(/^### (.*$)/gim,"<h3>$1</h3>"),n=n.replace(/^## (.*$)/gim,"<h2>$1</h2>"),n=n.replace(/^# (.*$)/gim,"<h1>$1</h1>"),n=n.replace(/^---$/gim,"<hr>"),n=n.replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>"),n=n.replace(/`([^`]+)`/g,"<code>$1</code>"),n=n.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),n=n.replace(/\*(.+?)\*/g,"<em>$1</em>"),n=function(e){const n=/(\|.+\|[\r\n]+\|[\s\-\|]+\|[\r\n]+(?:\|.+\|[\r\n]*)+)/g;return e.replace(n,e=>{const n=e.trim().split("\n").filter(e=>e.trim());if(n.length<2)return e;const t=n[0],o=(n[1],n.slice(2));return`<div class="table-wrapper" style="overflow-x: auto; width: 100%; max-width: 100%; box-sizing: border-box;"><table style="width: 250%; max-width: 250%; table-layout: fixed;"><thead><tr>${t.split("|").slice(1,-1).map(e=>e.trim()).map(e=>`<th>${e}</th>`).join("")}</tr></thead><tbody>${o.map(e=>`<tr>${e.split("|").slice(1,-1).map(e=>e.trim()).map(e=>`<td>${e}</td>`).join("")}</tr>`).join("")}</tbody></table></div>`})}(n),n=function(e){return e=(e=(e=(e=(e=e.replace(/\*\*(.+?)\*\* — (.+)/g,'<div class="list-item"><strong>$1</strong> — $2</div>')).replace(/\*\*(.+?)\*\* – (.+)/g,'<div class="list-item"><strong>$1</strong> – $2</div>')).replace(/\*\*(.+?)\*\* - (.+)/g,'<div class="list-item"><strong>$1</strong> - $2</div>')).replace(/^[\s]*\d+\. (.+)$/gim,"<li>$1</li>")).replace(/(<li>.*<\/li>[\s]*)+/g,e=>`<ol>${e}</ol>`)}(n),n=n.replace(/^> (.+)$/gim,"<blockquote>$1</blockquote>"),n=n.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>'),n=n.replace(/(https?:\/\/[^\s]+)/g,'<a href="$1" target="_blank" rel="noopener noreferrer">$1</a>'),n=n.replace(/\n/g,"<br>"),n=n.replace(/(<br>\s*)+$/g,""),n=n.replace(/\s*\*\*\s*$/g,""),n}(c),a.appendChild(d),l&&l.length>0){const e=function(e,n=!1){if(!e||0===e.length)return null;const t=document.createElement("div");t.className="source-cards-container",t.style.cssText="\n    margin-top: 16px;\n    display: flex;\n    flex-direction: column;\n    width: 100%;\n    max-width: 100%;\n    box-sizing: border-box;\n  ";const o=document.createElement("div");o.style.cssText="\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 12px 16px;\n    background: #1a1a1a;\n    border: 1px solid #333333;\n    border-radius: 12px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    user-select: none;\n  ";const r=document.createElement("span");r.style.cssText="\n    color: #ffffff;\n    font-weight: 600;\n    font-size: 14px;\n  ",r.textContent=`Sources (${e.length})`;const i=document.createElement("span");i.style.cssText="\n    color: var(--ciq-blue);\n    font-size: 16px;\n    transition: transform 0.2s ease;\n    margin-left: auto;\n  ",i.innerHTML="▼",o.appendChild(r),o.appendChild(i);const s=document.createElement("div");s.className="cards-container",s.style.cssText=`\n    display: none;\n    margin-top: 12px;\n    position: relative;\n    width: ${n?"500px":"300px"};\n    max-width: ${n?"500px":"300px"};\n    box-sizing: border-box;\n    overflow: hidden;\n    height: 180px;\n    margin-left: auto;\n    margin-right: auto;\n  `;const a=document.createElement("div");a.className="scrollable-area";const l=n?"500px":"300px";a.style.cssText=`\n    display: flex;\n    gap: 0;\n    overflow: hidden;\n    scroll-behavior: smooth;\n    padding: 8px 0;\n    scrollbar-width: none;\n    -ms-overflow-style: none;\n    width: ${l};\n    max-width: ${l};\n    flex-wrap: nowrap;\n    position: relative;\n    box-sizing: border-box;\n    min-width: 0;\n    height: 180px;\n  `,a.style.cssText+="\n    scrollbar-width: none;\n    -ms-overflow-style: none;\n  ";const c=document.createElement("style");c.textContent="\n    .source-scrollable::-webkit-scrollbar {\n      display: none;\n    }\n  ",document.head.appendChild(c),a.classList.add("source-scrollable");const d=document.createElement("button");d.style.cssText="\n    position: absolute;\n    left: 8px;\n    top: 50%;\n    transform: translateY(-50%);\n    width: 28px;\n    height: 28px;\n    border-radius: 50%;\n    border: none;\n    background: rgba(26,26,26,0.8);\n    border: 1px solid #333333;\n    color: #ffffff;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    z-index: 10;\n    box-shadow: 0 2px 8px rgba(0,0,0,0.3);\n    transition: all 0.2s ease;\n    opacity: 0.7;\n  ",d.innerHTML="‹",d.onmouseover=()=>{d.style.background="#333333",d.style.borderColor="var(--ciq-blue)"},d.onmouseout=()=>{d.style.background="#1a1a1a",d.style.borderColor="#333333"};const p=document.createElement("button");p.style.cssText="\n    position: absolute;\n    right: 8px;\n    top: 50%;\n    transform: translateY(-50%);\n    width: 28px;\n    height: 28px;\n    border-radius: 50%;\n    border: none;\n    background: rgba(26,26,26,0.8);\n    border: 1px solid #333333;\n    color: #ffffff;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    z-index: 10;\n    box-shadow: 0 2px 8px rgba(0,0,0,0.3);\n    transition: all 0.2s ease;\n    opacity: 0.7;\n  ",p.innerHTML="›",p.onmouseover=()=>{p.style.background="#333333",p.style.borderColor="var(--ciq-blue)"},p.onmouseout=()=>{p.style.background="#1a1a1a",p.style.borderColor="#333333"},e.forEach((e,t)=>{const o=document.createElement("div");o.className="source-card";const r=n?"500px":"300px";o.style.cssText=`\n      \n  background: #1a1a1a;\n  border: 1px solid #333333;\n  border-radius: 12px;\n  padding: 16px 16px 32px 16px;\n  margin: 0;\n  box-shadow: 0 4px 12px rgba(0,0,0,0.2);\n  transition: all 0.2s ease;\n  overflow: hidden;\n  word-wrap: break-word;\n  overflow-wrap: break-word;\n  word-break: normal;\n  hyphens: none;\n  box-sizing: border-box;\n  min-height: 160px;\n\n      width: ${r};\n      min-width: ${r};\n      max-width: ${r};\n      flex-shrink: 0;\n      flex-grow: 0;\n      overflow: hidden;\n      box-sizing: border-box;\n    `;const i=document.createElement("div");i.style.cssText="\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      margin-bottom: 8px;\n      overflow: hidden;\n      width: 100%;\n      box-sizing: border-box;\n    ";const s=document.createElement("span");s.style.cssText="\n      background: #246BFD;\n      color: white;\n      font-size: 12px;\n      font-weight: 600;\n      padding: 4px 8px;\n      border-radius: 6px;\n      min-width: 20px;\n      text-align: center;\n    ",s.textContent=`【${e.number}】`;const l=document.createElement("a");l.href=e.url,l.target="_blank",l.rel="noopener noreferrer",l.style.cssText=D,l.textContent="View source",l.onmouseover=()=>{l.style.cssText=D+"\n  border-bottom-color: #246BFD;\n"},l.onmouseout=()=>{l.style.cssText=D},i.appendChild(s),i.appendChild(l);const c=document.createElement("div");c.style.cssText="\n      color: #cccccc;\n      font-size: 15px;\n      line-height: 1.5;\n      word-wrap: break-word;\n      overflow-wrap: break-word;\n      word-break: normal;\n      hyphens: none;\n      overflow: hidden;\n      max-width: 100%;\n      white-space: normal;\n      min-height: 60px;\n      box-sizing: border-box;\n    ",c.textContent=e.description,o.appendChild(i),o.appendChild(c),a.appendChild(o)});let g=0;function h(){d.style.display=g>0?"flex":"none",p.style.display=g<e.length-1?"flex":"none"}function u(t){if(t>=0&&t<e.length){g=t;const e=n?500:300;a.scrollTo({left:t*e,behavior:"smooth"}),h()}}d.onclick=()=>{g>0&&u(g-1)},p.onclick=()=>{g<e.length-1&&u(g+1)},h();let x=!1;return o.onclick=()=>{x=!x,x?(s.style.display="block",i.style.transform="rotate(180deg)",o.style.borderBottomLeftRadius="0",o.style.borderBottomRightRadius="0",g=0,a.scrollTo({left:0,behavior:"smooth"}),h()):(s.style.display="none",i.style.transform="rotate(0deg)",o.style.borderBottomLeftRadius="12px",o.style.borderBottomRightRadius="12px")},o.onmouseover=()=>{o.style.background="#333333",o.style.borderColor="var(--ciq-blue)"},o.onmouseout=()=>{o.style.background="#1a1a1a",o.style.borderColor="#333333"},s.appendChild(d),s.appendChild(a),s.appendChild(p),t.appendChild(o),t.appendChild(s),t}(l,"600px"===t.style.width);e&&a.appendChild(e)}if(!n&&o){const n=o;console.log("[contentIQ widget] Using server message ID"),d.dataset.messageId=n;const t=function(e,n){if(!n)return console.error("[contentIQ widget] Missing messageId in createActionIcons"),document.createElement("div");const t=document.createElement("div");return t.style.cssText="display:flex; gap:12px; align-items:center; margin-left:2px; margin-top:8px;",["copy","thumbs-up","thumbs-down"].forEach(o=>{const r=document.createElement("div");r.style.cssText="\n    width:28px; height:28px;\n    display:flex; align-items:center; justify-content:center;\n    border-radius:10px; background:#1a1a1a; border:1px solid #333333;\n    cursor:pointer; transition: background .15s ease, border-color .15s ease, transform .1s ease;\n    box-shadow: 0 3px 8px rgba(0,0,0,.2);\n    color: #ffffff;\n  ",r.innerHTML=O(o),r.onmouseover=()=>{r.style.background="#333333",r.style.borderColor="var(--ciq-blue)",r.style.transform="translateY(-1px)"},r.onmouseout=()=>{r.style.background="#1a1a1a",r.style.borderColor="#333333",r.style.transform="none"},"copy"===o&&(r.onclick=async()=>{try{await navigator.clipboard.writeText(e);const n=r.innerHTML;r.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>',r.style.background="#10B981",r.style.borderColor="#10B981",r.style.color="#fff",setTimeout(()=>{r.innerHTML=n,r.style.background="#1a1a1a",r.style.borderColor="#333333",r.style.color="#ffffff"},1500)}catch(n){console.error("Failed to copy text: ",n);const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}}),"thumbs-up"!==o&&"thumbs-down"!==o||(r.dataset.feedbackType="thumbs-up"===o?"helpful":"not_helpful",r.dataset.feedbackButton=o,r.title="thumbs-up"===o?"This was helpful":"This was not helpful",r.onclick=async()=>{try{r.parentElement.querySelectorAll("[data-feedback-button]").forEach(e=>{e.style.background="#1a1a1a",e.style.borderColor="#333333",e.style.transform="none",e.style.color="#ffffff",e.classList.remove("selected-feedback")}),r.style.background="thumbs-up"===o?"#1a3d1a":"#3d1a1a",r.style.borderColor="thumbs-up"===o?"#10B981":"#EF4444",r.style.transform="translateY(-2px)",r.classList.add("selected-feedback"),await Y(n,r.dataset.feedbackType);const e=r.innerHTML;r.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>',r.style.background="#10B981",r.style.borderColor="#10B981",r.style.color="#fff",setTimeout(()=>{r.innerHTML=e,r.style.background="thumbs-up"===o?"#1a3d1a":"#3d1a1a",r.style.borderColor="thumbs-up"===o?"#10B981":"#EF4444",r.style.color="#ffffff"},1500)}catch(e){console.error("Failed to send feedback:",e)}}),t.appendChild(r)}),t}(e,n);a.appendChild(t)}else n||o||console.log("[contentIQ widget] No message ID provided - skipping action icons");r.append(i,a),T.appendChild(r),T.scrollTop=T.scrollHeight}function J(){const e=document.getElementById("typing-indicator");e&&e.remove()}async function Y(e,n){if(!e||!n)return void console.error("[contentIQ widget] Missing messageId or feedbackType for feedback");console.log("[contentIQ widget] Sending feedback");if(p())return void console.log("[contentIQ widget] Thread timed out, skipping feedback");const t=`widget_${o}_${i}`;try{const s=await u(),a=await fetch(r+"/api/widget/feedback",{method:"POST",headers:{"Content-Type":"application/json","X-Agent-Id":o,"X-Session-Id":i||"new"},body:JSON.stringify({...s,thread_id:t,message_id:e,feedback_type:n})});if(!a.ok)return void console.error(`[contentIQ widget] Error sending feedback: ${a.status}`);const l=await a.json();return console.log("[contentIQ widget] Feedback sent successfully"),d(),l}catch(e){throw console.error("[contentIQ widget] Error sending feedback:",e),e}}async function X(e){if(!e.trim())return;R(e,!0),B.value="";p()&&(console.log("[contentIQ widget] Thread timed out, clearing session for new thread"),localStorage.removeItem(l),i=null),d(),function(){const e=document.createElement("div");e.id="typing-indicator",e.style.cssText="\n    display:flex; align-items:flex-start; gap:12px; margin: 0 0 20px;\n  ";const n=document.createElement("div");n.style.cssText="\n    width:40px; height:40px; border-radius:50%; flex-shrink:0;\n    background: var(--ciq-blue); color:#fff; font-weight:700; font-size:15px;\n    display:flex; align-items:center; justify-content:center;\n    box-shadow: 0 10px 22px rgba(36,107,253,.35);\n  ",n.textContent="S";const t=document.createElement("div");t.style.cssText="flex:1; display:flex; flex-direction:column; align-items:flex-start;";const o=document.createElement("div");o.style.cssText="\n    background: var(--bubble);\n    color: #000;\n    padding: 12px 16px;\n    border-radius: 20px;\n    border: 1px solid var(--border);\n    font-size:15px; line-height:1.45; max-width:80%;\n    box-shadow: 0 8px 22px rgba(17,24,39,.06);\n    display: flex;\n    align-items: center;\n    gap: 4px;\n  ";const r=document.createElement("div");r.style.cssText="\n    display: flex;\n    gap: 4px;\n    align-items: center;\n  ";for(let e=0;e<3;e++){const n=document.createElement("div");n.style.cssText=`\n      width: 6px;\n      height: 6px;\n      border-radius: 50%;\n      background: #6B7280;\n      animation: typing-dot 1.4s infinite ease-in-out;\n      animation-delay: ${.16*e}s;\n    `,r.appendChild(n)}o.appendChild(r),t.appendChild(o),e.append(n,t),T.appendChild(e),T.scrollTop=T.scrollHeight}();try{const n=await u(),t=await fetch(r+"/api/widget/chat",{method:"POST",headers:{"Content-Type":"application/json","X-Agent-Id":o,"X-Session-Id":i||"new"},body:JSON.stringify({...n,message:e})});if(J(),!t.ok)return void R(`Error: ${t.status}`,!1,null);const s=await t.json(),a=function(e){try{const n=JSON.parse(e);return n.assistant?n.assistant:JSON.stringify(n)}catch(n){return e}}(s.assistant),c=s.message_id,p=t.headers.get("X-New-Session-ID");if(p){console.log("[contentIQ widget] Server provided new session ID due to thread timeout"),i=p;const e={sessionId:i,lastActivity:Date.now(),created:Date.now()};localStorage.setItem(l,JSON.stringify(e)),console.log("[contentIQ widget] New session stored after thread timeout")}console.log("[contentIQ widget] Received server response"),R(a,!1,c);const g=c;if(console.log("[contentIQ widget] Setting up delayed feedback"),g&&setTimeout(()=>{const e=document.querySelectorAll("[data-message-id]");let n=null;for(const t of e)if(t.dataset.messageId===g){n=t;break}if(n){const e=n.parentElement;if(e){0===e.querySelectorAll("[data-feedback-button].selected-feedback").length&&(console.log("[contentIQ widget] No feedback given, sending neutral feedback"),Y(g,"neutral").catch(e=>{console.error("[contentIQ widget] Error sending neutral feedback:",e)}))}}else console.warn("[contentIQ widget] Could not find message bubble for feedback")},3e4),!p&&s.session_id&&s.session_id!==i){i=s.session_id;const e={sessionId:i,lastActivity:Date.now(),created:Date.now()};localStorage.setItem(l,JSON.stringify(e)),console.log("[contentIQ widget] New session stored")}else d()}catch(e){J(),R("Sorry, I encountered an error. Please try again.",!1,null),console.error("[contentIQ widget] Network or other error:",e)}}A.addEventListener("click",U),t.append(A),j.append(b,T,M),t.append(j),B.addEventListener("keydown",e=>{"Enter"===e.key&&B.value.trim()&&X(B.value.trim())}),L.addEventListener("click",()=>{B.value.trim()&&X(B.value.trim())}),Q.addEventListener("click",()=>console.log("Voice input clicked"))}();
