/* contentIQ Chat Widget – minified version */
(async()=>{const e=document.querySelector(".contentiq_symplisticai_chat");if(!e)return void console.error("[contentIQ widget] Root DIV not found");const t=e.dataset.agent,n=document.currentScript,o=n.dataset.token,i=n.dataset.backend||"http://localhost:1234";const a=new TextEncoder;function r(e){return Array.from(e).map(e=>e.toString(16).padStart(2,"0")).join("")}async function s(e,t){const n=Uint8Array.from(e.match(/.{1,2}/g).map(e=>parseInt(e,16))),o=await crypto.subtle.importKey("raw",n,{name:"HMAC",hash:"SHA-256"},!1,["sign"]),i=await crypto.subtle.sign("HMAC",o,a.encode(t));return r(new Uint8Array(i))}async function l(){const e=Math.floor(Date.now()/1e3).toString(),n=await s(o,`${e}|${t}`);return{agent_id:t,token:o,ts:e,sig:n}}(async()=>{try{const{ts:e,sig:n}=await l(),a=new URL(i+"/api/deploy/validateToken");a.searchParams.set("agent_id",t),a.searchParams.set("token",o),a.searchParams.set("ts",e),a.searchParams.set("sig",n);await fetch(a).then(e=>e.ok)||console.warn("[contentIQ widget] Token validation failed")}catch(e){console.warn("[contentIQ widget] Validation error",e)}})(),e.style.cssText="\n    --ciq-blue:#246BFD; --ciq-blue-dark:#0F56E0;\n    --ink:#111827; --muted:#8E8E93; --border:#E5E8F0;\n  \n    position: fixed; bottom: 60px; right: 24px;\n    width: 64px; height: 64px;             /* Start as small icon */\n    display:flex; align-items:center; justify-content:center; z-index:9999;\n    border-radius: 50%;\n    border: 1px solid #ECEEF5;\n    background: var(--ciq-blue);\n    box-shadow: 0 22px 48px rgba(17,24,39,0.18), 0 2px 8px rgba(17,24,39,0.06);\n    font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial;\n    color: var(--ink);\n    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  ";const c=document.createElement("div");c.style.cssText="\n  background: transparent;\n  padding: 18px 22px 0;                    /* tighter top bar */\n  display:flex; align-items:center; gap:12px;\n  justify-content:center;                  /* ← centered like screenshot */\n  text-align:center;                       /* ensure text centers with logo */\n  position: relative;\n";const d=document.createElement("button");d.style.cssText="\n  position: absolute;\n  top: 18px;\n  right: 22px;\n  width: 24px;\n  height: 24px;\n  border: none;\n  background: transparent;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #000;\n  font-size: 18px;\n  font-weight: bold;\n  border-radius: 50%;\n  transition: background-color 0.2s ease;\n",d.innerHTML="×",d.onmouseover=()=>{d.style.backgroundColor="rgba(0,0,0,0.1)"},d.onmouseout=()=>{d.style.backgroundColor="transparent"},d.onclick=e=>{e.stopPropagation(),B()};const p=document.createElement("div"),g=document.createElement("div");g.innerHTML='<span style="color:#000;">symplistic.</span><span style="color:var(--ciq-blue)">contentIQ</span>',g.style.cssText="\n  font-weight: 800; font-size: 18px; letter-spacing:.2px; margin-top: 10px;\n  margin-left: -18px;\n";const h=document.createElement("div");h.style.cssText="display:none;",h.textContent=(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),c.append(p,g,h,d);const m=document.createElement("div");m.style.cssText="\n  flex:1; overflow-y:auto;\n  padding: 60px 22px 10px 22px;            /* ↑ adds space under header */\n  background: transparent;\n";const u=document.createElement("div");u.style.cssText="\n  display:flex; align-items:flex-start; gap:12px;\n  margin: 0 0 16px;                        /* increased spacing between messages */\n";const y=document.createElement("div");y.style.cssText="\n  width: 40px; height: 40px; border-radius: 50%; flex-shrink:0;\n  background: var(--ciq-blue); color:#fff; font-weight:700; font-size:15px;\n  display:flex; align-items:center; justify-content:center;\n  box-shadow: 0 10px 22px rgba(36,107,253,.35);\n",y.textContent="S";const f=document.createElement("div");f.style.cssText="flex:1;";const b=document.createElement("div");b.style.cssText="\n  font-weight:700; font-size:15px; color:#000; margin: 4px 0 8px; display:flex; align-items:center; gap:12px;\n",b.textContent="ContentIQ";const x=document.createElement("div");x.style.cssText="\n  background: var(--bubble);\n  border: 1px solid var(--border);\n  color:#000;\n  padding: 14px 16px;\n  border-radius: 20px;\n  font-size: 15px; line-height: 1.45;\n  max-width: 86%;\n  box-shadow: 0 8px 22px rgba(17,24,39,.06);\n  margin-bottom: 16px;\n",x.textContent="Welcome to symplistic.ai! Ask me anything!";const v=document.createElement("div");v.style.cssText="display:flex; gap:12px; align-items:center; margin-left:2px;",["copy","thumbs-up","thumbs-down"].forEach(e=>{const t=document.createElement("div");t.style.cssText="\n    width:28px; height:28px;\n    display:flex; align-items:center; justify-content:center;\n    border-radius:10px; background:#F3F5FA; border:1px solid var(--border);\n    cursor:pointer; transition: background .15s ease, border-color .15s ease, transform .1s ease;\n    box-shadow: 0 3px 8px rgba(17,24,39,.05);\n  ",t.innerHTML=I(e),t.onmouseover=()=>{t.style.background="#EEF2FF",t.style.borderColor="var(--ciq-blue)",t.style.transform="translateY(-1px)"},t.onmouseout=()=>{t.style.background="#F3F5FA",t.style.borderColor="var(--border)",t.style.transform="none"},v.appendChild(t)}),f.append(b,x,v),u.append(y,f);const w=document.createElement("div");w.style.cssText="display:none;",m.append(u,w);const k=document.createElement("div");k.style.cssText="\n  position: relative;\n  background: transparent;\n  padding: 12px 22px 22px 22px;\n  border-top: 0;\n  display: flex; flex-direction: column; gap: 8px;\n";const E=document.createElement("input");E.type="text",E.placeholder="Ask me anything...",E.style.cssText="\n  width: 100%;\n  height: 56px;\n  background: linear-gradient(180deg, #F6F8FC 0%, #F5F7FB 100%);\n  border: 1px solid #E3E9F3;\n  border-radius: 22px;\n  padding: 0 76px 0 50px;            /* room for mic + right breathing */\n  font-size: 16px; color: #111827; outline: none;\n  box-shadow:\n    inset 0 1px 0 rgba(255,255,255,.75),\n    0 12px 28px rgba(17,24,39,.06);\n";const C=document.createElement("button");C.style.cssText="\n   position: absolute;\n   left: 18px;\n   top: 52%; transform: translateY(-50%);\n   width: 22px; height: 22px;\n   border: 0; background: transparent; padding: 0; margin: 0;\n   display: flex; align-items: center; justify-content: center;\n   color: #6B7280; opacity: .95; cursor: pointer;\n ",C.innerHTML=I("mic"),C.style.zIndex="2",C.onmouseover=()=>C.style.opacity="1",C.onmouseout=()=>C.style.opacity=".9";const z=document.createElement("button");z.classList.add("ciq-fab"),z.style.cssText="\n   position: absolute;\n   right: -2px; top: 50%; transform: translateY(-50%);\n   width: 64px; height: 64px;\n   border: none; border-radius: 50%;\n   background: #246BFD;\n   display: flex; align-items: center; justify-content: center; cursor: pointer;\n   z-index: 1;                                         /* only above input, not disclaimer */\n   filter: drop-shadow(0 6px 16px rgba(36,107,253,.35));\n   transition: background .12s ease;\n ",z.innerHTML=I("send"),z.style.zIndex="3",z.onmouseover=()=>{z.style.background="#0F56E0"},z.onmouseout=()=>{z.style.background="#246BFD"};const S=document.createElement("style");S.textContent+="\n  .contentiq_symplisticai_chat input::placeholder { color:#9AA3AF; opacity:1; }\n\n  /* Markdown styling */\n  .contentiq_symplisticai_chat strong { font-weight: 700; }\n  .contentiq_symplisticai_chat em { font-style: italic; }\n  .contentiq_symplisticai_chat code { \n    background: rgba(0,0,0,0.1); \n    padding: 2px 4px; \n    border-radius: 4px; \n    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;\n    font-size: 0.9em;\n  }\n  .contentiq_symplisticai_chat ul { \n    margin: 8px 0; \n    padding-left: 20px; \n  }\n  .contentiq_symplisticai_chat li { \n    margin: 4px 0; \n    line-height: 1.4; \n  }\n\n  /* double halo around the blue FAB */\n  .contentiq_symplisticai_chat .ciq-fab::before,\n  .contentiq_symplisticai_chat .ciq-fab::after{\n    content:\"\"; position:absolute; left:50%; top:50%;\n    border-radius:50%; pointer-events:none; transform:translate(-50%,-50%);\n  }\n  /* outer soft ring */\n  .contentiq_symplisticai_chat .ciq-fab::before{\n    width:112px; height:112px;\n    background: radial-gradient(circle,\n      rgba(36,107,253,.16) 0%, rgba(36,107,253,.10) 55%, rgba(36,107,253,0) 70%);\n    filter: blur(2px);\n  }\n  /* inner tighter ring */\n  .contentiq_symplisticai_chat .ciq-fab::after{\n    width:88px; height:88px;\n    background: radial-gradient(circle,\n      rgba(36,107,253,.22) 0%, rgba(36,107,253,.14) 55%, rgba(36,107,253,0) 72%);\n  }\n",document.head.appendChild(S);const F=document.createElement("div");F.style.cssText="\n  font-size: 11px;\n  color: #6B7280;\n  text-align: center;\n  margin-top: 8px;\n  line-height: 1.3;\n  opacity: 0.8;\n  width: 100%;\n  position: relative;\n  z-index: 2;\n",F.textContent="contentIQ can make mistakes. Check important info here.";const T=document.createElement("div");T.style.cssText="\n  position: relative;\n  width: 100%;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n",T.append(E,C,z),k.append(T,F);const $=document.createElement("div");$.style.cssText="\n  width: 40px; height: 40px; border-radius: 50%;\n  background: var(--ciq-blue); color:#fff; font-weight:700; font-size:18px;\n  display:flex; align-items:center; justify-content:center;\n  box-shadow: 0 10px 22px rgba(36,107,253,.35);\n  cursor: grab;\n",$.textContent="S";const A=document.createElement("div");A.style.cssText="\n  width: 420px; height: 650px;\n  display: none; flex-direction: column; overflow: hidden;\n  border-radius: 22px;\n  border: 1px solid #ECEEF5;\n  background: radial-gradient(circle at center, #FFFFFF 0%, #F0EEFF 30%, #E0D8FF 60%, #D0C8FF 80%);\n  box-shadow: 0 22px 48px rgba(17,24,39,0.18), 0 2px 8px rgba(17,24,39,0.06);\n";let j=!1;function B(){j=!j,j?(e.style.width="420px",e.style.height="650px",e.style.borderRadius="22px",e.style.flexDirection="column",e.style.overflow="hidden",$.style.display="none",A.style.display="flex"):(e.style.width="64px",e.style.height="64px",e.style.borderRadius="50%",e.style.flexDirection="row",e.style.overflow="visible",$.style.display="flex",A.style.display="none")}$.addEventListener("click",B),e.append($),A.append(c,m,k),e.append(A);function M(e){try{const t=JSON.parse(e);return t.assistant?t.assistant:JSON.stringify(t)}catch(t){return e}}function D(e){if(!e)return"";let t=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/__(.*?)__/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/_(.*?)_/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>").replace(/\n/g,"<br>").replace(/^\s*[\*\-]\s+(.+)$/gm,"<li>$1</li>").replace(/^\s*\d+\.\s+(.+)$/gm,"<li>$1</li>");return t=t.replace(/(<li>.*<\/li>)/gs,"<ul>$1</ul>"),t}function I(e){return{copy:'<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>',"thumbs-up":'<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2z"/></svg>',"thumbs-down":'<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.59-6.59c.36-.36.58-.86.58-1.41V5c0-1.1-.9-2-2-2zm4 0v12h4V3h-4z"/></svg>',mic:'<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 3 2.89 5.35 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.43 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14z"/></svg>',send:'<svg width="22" height="22" viewBox="0 0 24 24" fill="white" style="transform: translateX(1px);"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>'}[e]||""}function L(e){const t=document.createElement("div");return t.style.cssText="display:flex; gap:12px; align-items:center; margin-left:2px; margin-top:8px;",["copy","thumbs-up","thumbs-down"].forEach(n=>{const o=document.createElement("div");if(o.style.cssText="\n      width:28px; height:28px;\n      display:flex; align-items:center; justify-content:center;\n      border-radius:10px; background:#F3F5FA; border:1px solid var(--border);\n      cursor:pointer; transition: background .15s ease, border-color .15s ease, transform .1s ease;\n      box-shadow: 0 3px 8px rgba(17,24,39,.05);\n    ",o.innerHTML=I(n),o.onmouseover=()=>{o.style.background="#EEF2FF",o.style.borderColor="var(--ciq-blue)",o.style.transform="translateY(-1px)"},o.onmouseout=()=>{o.style.background="#F3F5FA",o.style.borderColor="var(--border)",o.style.transform="none"},"copy"===n){o.onclick=async()=>{try{await navigator.clipboard.writeText(e);const t=o.innerHTML;o.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>',o.style.background="#10B981",o.style.borderColor="#10B981",o.style.color="#fff",setTimeout(()=>{o.innerHTML=t,o.style.background="#F3F5FA",o.style.borderColor="var(--border)",o.style.color="currentColor"},1500)}catch(t){console.error("Failed to copy text: ",t);const n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n)}};}t.appendChild(o)}),t}function H(e,t=!1){const n=document.createElement("div");n.style.cssText=`\n    display:flex; align-items:flex-start; gap:12px; margin: 0 0 20px;\n    ${t?"flex-direction: row-reverse;":""}\n  `;const o=document.createElement("div");o.style.cssText="\n    width:40px; height:40px; border-radius:50%; flex-shrink:0;\n    background: var(--ciq-blue); color:#fff; font-weight:700; font-size:15px;\n    display:flex; align-items:center; justify-content:center;\n    box-shadow: 0 10px 22px rgba(36,107,253,.35);\n  ",o.textContent=t?"U":"S";const i=document.createElement("div");i.style.cssText=`flex:1; display:flex; flex-direction:column; align-items:${t?"flex-end":"flex-start"};`;const a=document.createElement("div");a.style.cssText=`\n    background:${t?"var(--ciq-blue)":"var(--bubble)"};\n    color:${t?"#fff":"#000"};\n    padding: 12px 16px;\n    border-radius: 20px;\n    border: 1px solid ${t?"var(--ciq-blue)":"var(--border)"};\n    font-size:15px; line-height:1.45; max-width:80%; word-wrap:break-word; overflow-wrap:break-word;\n    box-shadow:${t?"0 12px 28px rgba(36,107,253,.30)":"0 8px 22px rgba(17,24,39,.06)"};\n  `,a.innerHTML=D(e),i.appendChild(a),t||i.appendChild(L(e)),n.append(o,i),m.appendChild(n),m.scrollTop=m.scrollHeight}async function N(e){if(e.trim()){H(e,!0),E.value="";try{const t=await l(),n=await fetch(i+"/api/widget/chat",{method:"POST",headers:{"Content-Type":"application/json","X-Agent-Id":t.agent_id},body:JSON.stringify({...t,message:e})});if(!n.ok)return void H(`Error: ${n.status}`,!1);const o=await n.text(),a=M(o);H(a,!1)}catch(e){H("Sorry, I encountered an error. Please try again.",!1),console.error(e)}}}E.addEventListener("keydown",e=>{"Enter"===e.key&&E.value.trim()&&N(E.value.trim())}),z.addEventListener("click",()=>{E.value.trim()&&N(E.value.trim())}),C.addEventListener("click",()=>console.log("Voice input clicked"))})();
